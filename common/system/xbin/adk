#!/system/bin/sh
# App Data Keeper (adk) APK Restorer
# Copyright (C) 2018, VR25 @ xda-developers
# License: GPL v3+


modID=adk
modData=/data/media/$modID
logsDir=$modData/logs
[ "$1" = "-r" ] && functionName=rm_uninstalled || functionName=restore_apps
newLog=$logsDir/${functionName}.log
oldLog=$logsDir/${functionName}_old.log

set -u

# use Magisk's busybox
[ -d /sbin/.core/busybox ] && PATH=/sbin/.core/busybox:$PATH \
  || PATH=/dev/magisk/bin:$PATH

  # verbose generator
mkdir -p $logsDir 2>/dev/null
[ -f "$newLog" ] && mv $newLog $oldLog
exec 2>$newLog

# find modPath
modPath=/sbin/.core/img/$modID
[[ -f $modPath/module.prop ]] || modPath=/magisk/$modID
[[ -f $modPath/module.prop ]] \
  || { echo -e "\n(!) modPath not found\n"; exit 1; }

. $modPath/core.sh
$functionName

exit 0
